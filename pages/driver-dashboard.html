<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver Dashboard - GO India RIDE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
        }

        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-logo {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .navbar-right {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .navbar-user {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
        }

        .status-badge.offline {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header-section {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title h1 {
            font-size: 2rem;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .header-title p {
            color: #999;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        .header-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .header-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .header-btn.secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .header-btn.secondary:hover {
            background: #f0f4ff;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }

        .stat-card h3 {
            color: #999;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
        }

        .stat-card .subtext {
            color: #999;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }

        .tabs {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .tab-buttons {
            display: flex;
            border-bottom: 2px solid #eee;
            overflow-x: auto;
        }

        .tab-button {
            flex: 1;
            padding: 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #999;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
            min-width: 150px;
        }

        .tab-button:hover {
            color: #667eea;
            background: #f9f9f9;
        }

        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
            padding: 2rem;
        }

        .tab-content.active {
            display: block;
        }

        .ride-list {
            display: grid;
            gap: 1.5rem;
        }

        .ride-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ride-card.completed {
            border-left-color: #4caf50;
        }

        .ride-card.pending {
            border-left-color: #ff9800;
        }

        .ride-info {
            flex: 1;
        }

        .ride-route {
            font-weight: bold;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .ride-details {
            display: flex;
            gap: 2rem;
            color: #999;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .customer-info {
            background: #f9f9f9;
            padding: 0.8rem;
            border-radius: 6px;
            margin-top: 0.8rem;
            font-size: 0.9rem;
        }

        .ride-actions {
            display: flex;
            gap: 1rem;
        }

        .ride-btn {
            padding: 0.6rem 1rem;
            border: 1px solid #667eea;
            background: none;
            color: #667eea;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .ride-btn:hover {
            background: #667eea;
            color: white;
        }

        .ride-btn.primary {
            background: #667eea;
            color: white;
        }

        .ride-btn.primary:hover {
            background: #764ba2;
        }

        .profile-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .profile-info {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .profile-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .profile-rating {
            color: #ffc107;
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .profile-detail {
            margin: 1rem 0;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }

        .profile-detail label {
            color: #999;
            font-size: 0.9rem;
        }

        .profile-detail-value {
            display: block;
            color: #333;
            font-weight: 600;
            margin-top: 0.3rem;
        }

        .edit-profile-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 1rem;
        }

        .edit-profile-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .earnings-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .earnings-label {
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .earnings-amount {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .earnings-period {
            display: flex;
            gap: 2rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255,255,255,0.2);
        }

        .earning-stat {
            flex: 1;
        }

        .earning-stat-label {
            opacity: 0.8;
            font-size: 0.9rem;
            margin-bottom: 0.3rem;
        }

        .earning-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .vehicle-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .vehicle-info {
            display: flex;
            gap: 2rem;
            align-items: center;
            margin-bottom: 2rem;
        }

        .vehicle-icon {
            font-size: 3rem;
            color: #667eea;
        }

        .vehicle-details h3 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
        }

        .vehicle-details p {
            color: #999;
            font-size: 0.9rem;
        }

        .documents-list {
            display: grid;
            gap: 1rem;
        }

        .document-item {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #eee;
        }

        .document-name {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .document-icon {
            font-size: 1.5rem;
            color: #667eea;
        }

        .document-info h4 {
            margin-bottom: 0.3rem;
        }

        .document-info p {
            color: #999;
            font-size: 0.85rem;
        }

        .document-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .status-verified {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
        }

        .status-pending {
            background: rgba(255, 152, 0, 0.2);
            color: #ff9800;
        }

        .status-expired {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }

        .ratings-section {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .rating-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
        }

        .rating-item:last-child {
            border-bottom: none;
        }

        .rating-info {
            flex: 1;
        }

        .rating-customer {
            font-weight: bold;
            color: #333;
            margin-bottom: 0.3rem;
        }

        .rating-date {
            color: #999;
            font-size: 0.85rem;
        }

        .rating-text {
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.3rem;
        }

        .rating-stars {
            color: #ffc107;
            font-size: 1rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #999;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #eee;
        }

        .modal-header h2 {
            margin: 0;
            color: #333;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.9rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }

        .form-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .message {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }

        .message.show {
            display: block;
        }

        .message.success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        .message.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        @media (max-width: 768px) {
            .navbar-container {
                padding: 0 1rem;
            }

            .container {
                padding: 1rem;
            }

            .profile-section {
                grid-template-columns: 1fr;
            }

            .header-section {
                flex-direction: column;
                gap: 1.5rem;
            }

            .ride-card {
                flex-direction: column;
                align-items: flex-start;
            }

            .ride-details {
                flex-direction: column;
                gap: 0.5rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .tab-buttons {
                overflow-x: auto;
            }

            .tab-button {
                min-width: 120px;
            }

            .earnings-period {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-logo">
                <i class="fas fa-car"></i>
                GO India RIDE - Driver
            </div>
            <div class="navbar-right">
                <div class="navbar-user">
                    <div class="user-avatar" id="userAvatar">D</div>
                    <span id="userName">Driver</span>
                    <button class="status-badge" id="statusBadge" onclick="toggleOnlineStatus()">
                        <i class="fas fa-circle"></i> Online
                    </button>
                </div>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </button>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="message success" id="successMessage">
            <i class="fas fa-check-circle"></i>
            <span id="successText"></span>
        </div>
        <div class="message error" id="errorMessage">
            <i class="fas fa-exclamation-circle"></i>
            <span id="errorText"></span>
        </div>

        <div class="header-section">
            <div class="header-title">
                <h1 id="welcomeMsg">Welcome back, Driver!</h1>
                <p>Manage your rides and earnings</p>
            </div>
            <div class="header-actions">
                <button class="header-btn" onclick="acceptRide()">
                    <i class="fas fa-check-circle"></i>
                    Accept Ride
                </button>
                <button class="header-btn secondary" onclick="viewRoute()">
                    <i class="fas fa-map"></i>
                    View Route
                </button>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>Today's Earnings</h3>
                <div class="value" id="todayEarnings">‚Çπ0</div>
                <div class="subtext">From <span id="todayRides">0</span> rides</div>
            </div>
            <div class="stat-card">
                <h3>Total Earnings</h3>
                <div class="value" id="totalEarnings">‚Çπ0</div>
                <div class="subtext">From <span id="totalRides">0</span> rides</div>
            </div>
            <div class="stat-card">
                <h3>Rating</h3>
                <div class="value" id="avgRating">5.0 ‚≠ê</div>
                <div class="subtext" id="ratingCount">0 ratings</div>
            </div>
        </div>

        <div class="tabs">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('rides')">
                    <i class="fas fa-car"></i> Pending Rides
                </button>
                <button class="tab-button" onclick="switchTab('completed')">
                    <i class="fas fa-check-circle"></i> Completed
                </button>
                <button class="tab-button" onclick="switchTab('earnings')">
                    <i class="fas fa-money-bill"></i> Earnings
                </button>
                <button class="tab-button" onclick="switchTab('profile')">
                    <i class="fas fa-user"></i> Profile
                </button>
                <button class="tab-button" onclick="switchTab('ratings')">
                    <i class="fas fa-star"></i> Ratings
                </button>
            </div>

            <div class="tab-content active" id="ridesTab">
                <div id="pendingRidesList" class="ride-list">
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>No pending rides. Check back soon!</p>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="completedTab">
                <div id="completedRidesList" class="ride-list">
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>No completed rides yet</p>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="earningsTab">
                <div class="earnings-card">
                    <div class="earnings-label">Total Earnings</div>
                    <div class="earnings-amount" id="totalEarningsDisplay">‚Çπ0</div>
                    <div class="earnings-period">
                        <div class="earning-stat">
                            <div class="earning-stat-label">Today</div>
                            <div class="earning-stat-value" id="todayEarningsDisplay">‚Çπ0</div>
                        </div>
                        <div class="earning-stat">
                            <div class="earning-stat-label">This Week</div>
                            <div class="earning-stat-value" id="weekEarningsDisplay">‚Çπ0</div>
                        </div>
                        <div class="earning-stat">
                            <div class="earning-stat-label">This Month</div>
                            <div class="earning-stat-value" id="monthEarningsDisplay">‚Çπ0</div>
                        </div>
                    </div>
                </div>

                <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 1.5rem;">Detailed Earnings</h3>
                    <div id="earningsDetail">
                        <div class="empty-state">
                            <i class="fas fa-chart-bar"></i>
                            <p>No earnings data yet</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="profileTab">
                <div class="profile-section">
                    <div class="profile-info">
                        <div class="profile-avatar" id="profileAvatar">D</div>
                        <div class="profile-name" id="profileName">Driver Name</div>
                        <div class="profile-rating" id="profileRating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5.0)</div>

                        <div class="profile-detail">
                            <label>Email</label>
                            <div class="profile-detail-value" id="profileEmail">email@example.com</div>
                        </div>

                        <div class="profile-detail">
                            <label>Mobile Number</label>
                            <div class="profile-detail-value" id="profilePhone">9876543210</div>
                        </div>

                        <div class="profile-detail">
                            <label>Member Since</label>
                            <div class="profile-detail-value" id="profileMemberSince">Jan 2024</div>
                        </div>

                        <button class="edit-profile-btn" onclick="openEditProfileModal()">
                            <i class="fas fa-edit"></i>
                            Edit Profile
                        </button>
                    </div>

                    <div class="profile-info">
                        <h3 style="margin-bottom: 1.5rem;">Vehicle Details</h3>

                        <div class="vehicle-info">
                            <div class="vehicle-icon">
                                <i class="fas fa-car"></i>
                            </div>
                            <div class="vehicle-details">
                                <h3 id="vehicleName">Vehicle Name</h3>
                                <p id="vehicleNumber">Registration: ABC 1234</p>
                            </div>
                        </div>

                        <div class="profile-detail">
                            <label>Vehicle Type</label>
                            <div class="profile-detail-value" id="vehicleType">Economy</div>
                        </div>

                        <div class="profile-detail">
                            <label>Year of Manufacture</label>
                            <div class="profile-detail-value" id="vehicleYear">2020</div>
                        </div>

                        <div class="profile-detail">
                            <label>Insurance Valid Till</label>
                            <div class="profile-detail-value" id="insuranceValid">31-Dec-2025</div>
                        </div>

                        <button class="edit-profile-btn" onclick="editVehicle()">
                            <i class="fas fa-edit"></i>
                            Edit Vehicle
                        </button>
                    </div>
                </div>

                <div style="margin-top: 2rem;">
                    <h3 style="margin-bottom: 1.5rem;">Documents</h3>
                    <div class="documents-list">
                        <div class="document-item">
                            <div class="document-name">
                                <div class="document-icon">
                                    <i class="fas fa-id-card"></i>
                                </div>
                                <div class="document-info">
                                    <h4>Driving License</h4>
                                    <p>DL123456789</p>
                                </div>
                            </div>
                            <div class="document-status status-verified">
                                <i class="fas fa-check-circle"></i> Verified
                            </div>
                        </div>

                        <div class="document-item">
                            <div class="document-name">
                                <div class="document-icon">
                                    <i class="fas fa-file-contract"></i>
                                </div>
                                <div class="document-info">
                                    <h4>Vehicle RC</h4>
                                    <p>RC123456</p>
                                </div>
                            </div>
                            <div class="document-status status-verified">
                                <i class="fas fa-check-circle"></i> Verified
                            </div>
                        </div>

                        <div class="document-item">
                            <div class="document-name">
                                <div class="document-icon">
                                    <i class="fas fa-file"></i>
                                </div>
                                <div class="document-info">
                                    <h4>PAN Card</h4>
                                    <p>PAN123456789A</p>
                                </div>
                            </div>
                            <div class="document-status status-verified">
                                <i class="fas fa-check-circle"></i> Verified
                            </div>
                        </div>

                        <div class="document-item">
                            <div class="document-name">
                                <div class="document-icon">
                                    <i class="fas fa-shield"></i>
                                </div>
                                <div class="document-info">
                                    <h4>Insurance Certificate</h4>
                                    <p>Expires: 31-Dec-2025</p>
                                </div>
                            </div>
                            <div class="document-status status-pending">
                                <i class="fas fa-clock"></i> Renew Soon
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="ratingsTab">
                <div class="ratings-section">
                    <h3 style="margin-bottom: 1.5rem;">Customer Ratings</h3>
                    <div id="ratingsList">
                        <div class="empty-state">
                            <i class="fas fa-star"></i>
                            <p>No ratings yet. Complete rides to get ratings!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="editProfileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Profile</h2>
                <button class="modal-close" onclick="closeEditProfileModal()">&times;</button>
            </div>

            <form onsubmit="saveProfile(event)">
                <div class="form-group">
                    <label for="editName">Full Name</label>
                    <input type="text" id="editName" required>
                </div>

                <div class="form-group">
                    <label for="editEmail">Email</label>
                    <input type="email" id="editEmail" required>
                </div>

                <div class="form-group">
                    <label for="editPhone">Phone</label>
                    <input type="tel" id="editPhone" required>
                </div>

                <div class="form-group">
                    <label for="editCity">City</label>
                    <input type="text" id="editCity">
                </div>

                <button type="submit" class="form-btn">Save Changes</button>
            </form>
        </div>
    </div>

    <script>
        let currentDriver = null;
        let isOnline = true;

        function checkAuth() {
            const userRole = localStorage.getItem('userRole');
            const currentDriverData = localStorage.getItem('currentDriver');

            if (userRole !== 'driver' || !currentDriverData) {
                alert('‚ùå Please login as driver first');
                window.location.href = './login.html';
                return null;
            }

            return JSON.parse(currentDriverData);
        }

        window.addEventListener('load', function() {
            currentDriver = checkAuth();
            if (!currentDriver) return;

            loadDashboard();
            loadRides();
            loadProfile();
            loadEarnings();
            loadRatings();
        });

        function loadDashboard() {
            const bookings = JSON.parse(localStorage.getItem('bookings')) || [];
            const driverBookings = bookings.filter(b => b.driverId === currentDriver.id);
            const completedBookings = driverBookings.filter(b => b.status === 'completed');

            const today = new Date().toDateString();
            const todayBookings = completedBookings.filter(b => new Date(b.createdAt).toDateString() === today);

            const todayEarnings = todayBookings.reduce((sum, b) => sum + ((b.totalFare || 0) * 0.7), 0);
            const totalEarnings = completedBookings.reduce((sum, b) => sum + ((b.totalFare || 0) * 0.7), 0);

            document.getElementById('welcomeMsg').textContent = `Welcome back, ${currentDriver.name}!`;
            document.getElementById('userName').textContent = currentDriver.name;
            document.getElementById('todayEarnings').textContent = `‚Çπ${Math.round(todayEarnings)}`;
            document.getElementById('todayRides').textContent = todayBookings.length;
            document.getElementById('totalEarnings').textContent = `‚Çπ${Math.round(totalEarnings)}`;
            document.getElementById('totalRides').textContent = completedBookings.length;

            const ratings = JSON.parse(localStorage.getItem(`ratings_${currentDriver.id}`)) || [];
            if (ratings.length > 0) {
                const avgRating = (ratings.reduce((a, b) => a + b.rating, 0) / ratings.length).toFixed(1);
                document.getElementById('avgRating').textContent = `${avgRating} ‚≠ê`;
                document.getElementById('ratingCount').textContent = `${ratings.length} ratings`;
            }

            const initials = currentDriver.name.split(' ').map(n => n[0]).join('').toUpperCase();
            document.getElementById('userAvatar').textContent = initials;
        }

        function loadRides() {
            const bookings = JSON.parse(localStorage.getItem('bookings')) || [];
            const driverBookings = bookings.filter(b => b.driverId === currentDriver.id);

            const pendingRides = driverBookings.filter(b => b.status === 'pending' || b.status === 'active');
            const completedRides = driverBookings.filter(b => b.status === 'completed');

            const pendingList = document.getElementById('pendingRidesList');
            if (pendingRides.length === 0) {
                pendingList.innerHTML = `<div class="empty-state"><i class="fas fa-inbox"></i><p>No pending rides. Check back soon!</p></div>`;
            } else {
                pendingList.innerHTML = pendingRides.map(ride => `
                    <div class="ride-card pending">
                        <div class="ride-info">
                            <div class="ride-route"><i class="fas fa-location-dot"></i> ${ride.pickup} ‚Üí ${ride.dropoff}</div>
                            <div class="ride-details">
                                <span><i class="fas fa-calendar"></i> ${new Date(ride.createdAt).toLocaleDateString()}</span>
                                <span><i class="fas fa-tag"></i> ${ride.rideType}</span>
                                <span><i class="fas fa-money-bill"></i> ‚Çπ${Math.round((ride.totalFare || 0) * 0.7)}</span>
                            </div>
                            <div class="customer-info">
                                <strong>Customer:</strong> ${ride.customerName || 'Unknown'} | <strong>Rating:</strong> 5.0
                            </div>
                        </div>
                        <div class="ride-actions">
                            <button class="ride-btn primary" onclick="acceptRideAction('${ride.id}')"><i class="fas fa-check"></i> Accept</button>
                            <button class="ride-btn" onclick="declineRide('${ride.id}')"><i class="fas fa-times"></i> Decline</button>
                        </div>
                    </div>
                `).join('');
            }

            const completedList = document.getElementById('completedRidesList');
            if (completedRides.length === 0) {
                completedList.innerHTML = `<div class="empty-state"><i class="fas fa-inbox"></i><p>No completed rides yet</p></div>`;
            } else {
                completedList.innerHTML = completedRides.map(ride => `
                    <div class="ride-card completed">
                        <div class="ride-info">
                            <div class="ride-route"><i class="fas fa-location-dot"></i> ${ride.pickup} ‚Üí ${ride.dropoff}</div>
                            <div class="ride-details">
                                <span><i class="fas fa-calendar"></i> ${new Date(ride.createdAt).toLocaleDateString()}</span>
                                <span><i class="fas fa-clock"></i> ${ride.duration || '30 mins'}</span>
                                <span><i class="fas fa-money-bill"></i> ‚Çπ${Math.round((ride.totalFare || 0) * 0.7)}</span>
                            </div>
                            <div class="customer-info">
                                <strong>Customer:</strong> ${ride.customerName || 'Unknown'} | <strong>Rating:</strong> 5.0
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function loadProfile() {
            const initials = currentDriver.name.split(' ').map(n => n[0]).join('').toUpperCase();
            document.getElementById('profileAvatar').textContent = initials;
            document.getElementById('profileName').textContent = currentDriver.name;
            document.getElementById('profileEmail').textContent = currentDriver.email;
            document.getElementById('profilePhone').textContent = currentDriver.phone;

            const joinDate = new Date(currentDriver.createdAt || Date.now());
            document.getElementById('profileMemberSince').textContent = joinDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short' });

            document.getElementById('vehicleName').textContent = currentDriver.vehicleType || 'Vehicle';
            document.getElementById('vehicleNumber').textContent = `Registration: ${currentDriver.vehicleNumber}`;
            document.getElementById('vehicleType').textContent = currentDriver.vehicleType || 'Economy';

            const ratings = JSON.parse(localStorage.getItem(`ratings_${currentDriver.id}`)) || [];
            if (ratings.length > 0) {
                const avgRating = (ratings.reduce((a, b) => a + b.rating, 0) / ratings.length).toFixed(1);
                document.getElementById('profileRating').textContent = `${'‚≠ê'.repeat(Math.round(avgRating))} (${avgRating})`;
            }

            document.getElementById('editName').value = currentDriver.name;
            document.getElementById('editEmail').value = currentDriver.email;
            document.getElementById('editPhone').value = currentDriver.phone;
        }

        function loadEarnings() {
            const bookings = JSON.parse(localStorage.getItem('bookings')) || [];
            const driverBookings = bookings.filter(b => b.driverId === currentDriver.id && b.status === 'completed');

            const totalEarnings = driverBookings.reduce((sum, b) => sum + ((b.totalFare || 0) * 0.7), 0);

            const today = new Date().toDateString();
            const todayEarnings = driverBookings
                .filter(b => new Date(b.createdAt).toDateString() === today)
                .reduce((sum, b) => sum + ((b.totalFare || 0) * 0.7), 0);

            document.getElementById('totalEarningsDisplay').textContent = `‚Çπ${Math.round(totalEarnings)}`;
            document.getElementById('todayEarningsDisplay').textContent = `‚Çπ${Math.round(todayEarnings)}`;

            const weekStart = new Date();
            weekStart.setDate(weekStart.getDate() - weekStart.getDay());
            const weekEarnings = driverBookings
                .filter(b => new Date(b.createdAt) >= weekStart)
                .reduce((sum, b) => sum + ((b.totalFare || 0) * 0.7), 0);
            document.getElementById('weekEarningsDisplay').textContent = `‚Çπ${Math.round(weekEarnings)}`;

            const monthStart = new Date();
            monthStart.setDate(1);
            const monthEarnings = driverBookings
                .filter(b => new Date(b.createdAt) >= monthStart)
                .reduce((sum, b) => sum + ((b.totalFare || 0) * 0.7), 0);
            document.getElementById('monthEarningsDisplay').textContent = `‚Çπ${Math.round(monthEarnings)}`;

            const detailList = document.getElementById('earningsDetail');
            if (driverBookings.length === 0) {
                detailList.innerHTML = `<div class="empty-state"><i class="fas fa-chart-bar"></i><p>No earnings data yet</p></div>`;
            } else {
                detailList.innerHTML = driverBookings.map(ride => `
                    <div style="padding: 1rem; border-bottom: 1px solid #eee; display: flex; justify-content: space-between;">
                        <div>
                            <strong>${ride.pickup} ‚Üí ${ride.dropoff}</strong><br>
                            <small style="color: #999;">${new Date(ride.createdAt).toLocaleDateString()}</small>
                        </div>
                        <strong style="color: #4caf50;">+‚Çπ${Math.round((ride.totalFare || 0) * 0.7)}</strong>
                    </div>
                `).join('');
            }
        }

        function loadRatings() {
            const ratings = JSON.parse(localStorage.getItem(`ratings_${currentDriver.id}`)) || [];

            const ratingsList = document.getElementById('ratingsList');
            if (ratings.length === 0) {
                ratingsList.innerHTML = `<div class="empty-state"><i class="fas fa-star"></i><p>No ratings yet. Complete rides to get ratings!</p></div>`;
            } else {
                ratingsList.innerHTML = ratings.map(r => `
                    <div class="rating-item">
                        <div class="rating-info">
                            <div class="rating-customer">${r.customerName || 'Customer'}</div>
                            <div class="rating-date">${new Date(r.date).toLocaleDateString()}</div>
                            ${r.comment ? `<div class="rating-text">"${r.comment}"</div>` : ''}
                        </div>
                        <div class="rating-stars">${'‚≠ê'.repeat(r.rating)}</div>
                    </div>
                `).join('');
            }
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));

            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
        }

        function openEditProfileModal() {
            document.getElementById('editProfileModal').classList.add('active');
        }

        function closeEditProfileModal() {
            document.getElementById('editProfileModal').classList.remove('active');
        }

        function saveProfile(e) {
            e.preventDefault();

            currentDriver.name = document.getElementById('editName').value;
            currentDriver.email = document.getElementById('editEmail').value;
            currentDriver.phone = document.getElementById('editPhone').value;

            let drivers = JSON.parse(localStorage.getItem('drivers')) || [];
            const idx = drivers.findIndex(d => d.id === currentDriver.id);
            if (idx !== -1) {
                drivers[idx] = currentDriver;
                localStorage.setItem('drivers', JSON.stringify(drivers));
                localStorage.setItem('currentDriver', JSON.stringify(currentDriver));
            }

            showSuccess('‚úÖ Profile updated!');
            loadProfile();
            loadDashboard();
            closeEditProfileModal();
        }

        function editVehicle() {
            alert('üöó Vehicle edit feature coming soon!');
        }

        function acceptRide() {
            alert('üöó Finding nearby rides...');
        }

        function acceptRideAction(rideId) {
            let bookings = JSON.parse(localStorage.getItem('bookings')) || [];
            const idx = bookings.findIndex(b => b.id === rideId);
            if (idx !== -1) {
                bookings[idx].status = 'active';
                localStorage.setItem('bookings', JSON.stringify(bookings));
                loadRides();
                loadDashboard();
                showSuccess('‚úÖ Ride accepted!');
            }
        }

        function declineRide(rideId) {
            if (confirm('Are you sure you want to decline this ride?')) {
                showSuccess('‚ùå Ride declined');
            }
        }

        function viewRoute() {
            alert('üó∫Ô∏è Map view coming soon!');
        }

        function toggleOnlineStatus() {
            isOnline = !isOnline;
            const badge = document.getElementById('statusBadge');

            if (isOnline) {
                badge.className = 'status-badge';
                badge.innerHTML = '<i class="fas fa-circle"></i> Online';
                showSuccess('‚úÖ You are now online');
            } else {
                badge.className = 'status-badge offline';
                badge.innerHTML = '<i class="fas fa-circle"></i> Offline';
                showSuccess('‚ùå You are now offline');
            }
        }

        function showSuccess(msg) {
            document.getElementById('successText').textContent = msg;
            document.getElementById('successMessage').classList.add('show');
            setTimeout(() => document.getElementById('successMessage').classList.remove('show'), 3000);
        }

        function showError(msg) {
            document.getElementById('errorText').textContent = msg;
            document.getElementById('errorMessage').classList.add('show');
            setTimeout(() => document.getElementById('errorMessage').classList.remove('show'), 3000);
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('currentDriver');
                localStorage.removeItem('userRole');
                window.location.href = './login.html';
            }
        }

        window.onclick = (e) => {
            if (e.target.id === 'editProfileModal') closeEditProfileModal();
        }

        console.log('üöÄ Driver Dashboard loaded');
    </script>
</body>
</html>
